(function(){var t=function(){!function(t){t.guid=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"guid",className:"_dataTrait"}),Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isArray",className:"_dataTrait"}),"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isFunction",className:"_dataTrait"}),"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isObject",className:"_dataTrait"}),"undefined"==typeof t?this.__isO:t===Object(t)}}(this);var t=function(){!function(t){t.on=function(t,e){return"undefined"!=typeof callCord&&callCord("main").record({fn:"on",className:""}),this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.removeListener=function(t,e){if("undefined"!=typeof callCord&&callCord("main").record({fn:"removeListener",className:""}),this._ev&&this._ev[t])for(var n=this._ev[t],i=0;i<n.length;i++)if(n[i]==e)return void n.splice(i,1)},t.trigger=function(t,e,n){if("undefined"!=typeof callCord&&callCord("main").record({fn:"trigger",className:""}),this._ev&&this._ev[t]){return this._ev[t].forEach(function(t){t(e,n)}),this}}}(this),function(t){t.guid=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"guid",className:"_dataTrait"}),Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isArray",className:"_dataTrait"}),"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isFunction",className:"_dataTrait"}),"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isObject",className:"_dataTrait"}),"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var e,n;t.disconnect=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"disconnect",className:"_clientSocket"}),this._socket.messageTo({disconnect:!0})},t.emit=function(t,e,n){"undefined"!=typeof callCord&&callCord("main").record({fn:"emit",className:"_clientSocket"});var i={name:t,data:e};if(n){i._callBackId=this.guid();var r=this,o=function(t){n(t),r.removeListener(i._callBackId,o)};this.on(i._callBackId,o)}this._socket.messageTo(i)},t.getEnum=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"getEnum",className:"_clientSocket"});var t=this.guid();return e[t]||(e[t]=n++),e[t]},t.getId=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"getId",className:"_clientSocket"}),this.socketId},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i){e||(e={},n=1);var r=this.guid();e[r]||(e[r]=n++);var a=this,c=o(t,i,"openConnection","client"),s=o(t,i,r,"client");this.socketId=r,s.on("clientMessage",function(t,e){e.connected?(a._socket=s,a.trigger("connect",s)):a.trigger(e.name,e.data)}),c.messageTo({socketId:r})}),t.send=function(t,e){"undefined"!=typeof callCord&&callCord("main").record({fn:"send",className:"_clientSocket"});var n=this;return _promise(function(i){n.emit(t,e,i)})}}(this)},e=function(t,n,i,r,o,a,c,s){var f,l=this;if(!(l instanceof e))return new e(t,n,i,r,o,a,c,s);var d=[t,n,i,r,o,a,c,s];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){f=t.apply(l,d)}),"function"==typeof f){if(f._classInfo.name!=e._classInfo.name)return new f(t,n,i,r,o,a,c,s)}else if(f)return f;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,d)}):"function"==typeof l.init&&l.init.apply(l,d)};e._classInfo={name:"_clientSocket"},e.prototype=new t,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(define([],function(){return e}),this._clientSocket=e):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._clientSocket=e:this._clientSocket=e}.call(new Function("return this")());var n=function(){!function(t){t.on=function(t,e){return"undefined"!=typeof callCord&&callCord("main").record({fn:"on",className:""}),this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.trigger=function(t,e,n){if("undefined"!=typeof callCord&&callCord("main").record({fn:"trigger",className:""}),this._ev&&this._ev[t]){return this._ev[t].forEach(function(t){t(e,n)}),this}}}(this),function(t){var e,n;t.emit=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"emit",className:"_serverSocket"})},t.getPrefix=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"getPrefix",className:"_serverSocket"}),this._ip+":"+this._port},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i){n||(n={},e={});var r=this;this._ip=t,this._port=i;var a=o(t,i,"openConnection","server");a.on("serverMessage",function(n,a){if(a.socketId){var c=o(t,i,a.socketId,"server"),s=f(c,r);e[a.socketId]=s,r.trigger("connect",s),s.isConnected()&&c.messageFrom({connected:!0,socketId:a.socketId})}})}),t.join=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"join",className:"_serverSocket"})},t.removeListener=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"removeListener",className:"_serverSocket"})}}(this)},i=function(t,e,n,r,o,a,c,s){var f,l=this;if(!(l instanceof i))return new i(t,e,n,r,o,a,c,s);var d=[t,e,n,r,o,a,c,s];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){f=t.apply(l,d)}),"function"==typeof f){if(f._classInfo.name!=i._classInfo.name)return new f(t,e,n,r,o,a,c,s)}else if(f)return f;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,d)}):"function"==typeof l.init&&l.init.apply(l,d)};i._classInfo={name:"_serverSocket"},i.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(define([],function(){return i}),this._serverSocket=i):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._serverSocket=i:this._serverSocket=i}.call(new Function("return this")());var r=function(){!function(t){t.on=function(t,e){return"undefined"!=typeof callCord&&callCord("main").record({fn:"on",className:""}),this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.trigger=function(t,e,n){if("undefined"!=typeof callCord&&callCord("main").record({fn:"trigger",className:""}),this._ev&&this._ev[t]){var i=this;return this._ev[t].forEach(function(t){t(i,e,n)}),this}}}(this),function(t){t.guid=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"guid",className:"_dataTrait"}),Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isArray",className:"_dataTrait"}),"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isFunction",className:"_dataTrait"}),"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isObject",className:"_dataTrait"}),"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var e;t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n,i,r){var o=this;this._server=t,this._port=n,this._socketId=i,this._dbName="tcp://"+this._server+":"+this._port+":"+this._socketId;var a=this._dbName+":to",s=this._dbName+":from";e||(e={}),e[a]||(e[a]=[]),e[s]||(e[s]=[]),c().every(.1,function(){if("server"==r){var t=e[a].slice();t.forEach(function(t){o.trigger("serverMessage",t),e[a].shift()})}if("client"==r){var t=e[s].slice();t.forEach(function(t){o.trigger("clientMessage",t),e[s].shift()})}})}),t.messageFrom=function(t){"undefined"!=typeof callCord&&callCord("main").record({fn:"messageFrom",className:"_tcpEmu"});var n=this._dbName+":from";e[n].push(t)},t.messageTo=function(t){"undefined"!=typeof callCord&&callCord("main").record({fn:"messageTo",className:"_tcpEmu"});var n=this._dbName+":to";e[n].push(t)}}(this)},o=function(t,e,n,i,r,a,c,s){var f,l=this;if(!(l instanceof o))return new o(t,e,n,i,r,a,c,s);var d=[t,e,n,i,r,a,c,s];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){f=t.apply(l,d)}),"function"==typeof f){if(f._classInfo.name!=o._classInfo.name)return new f(t,e,n,i,r,a,c,s)}else if(f)return f;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,d)}):"function"==typeof l.init&&l.init.apply(l,d)};o._classInfo={name:"_tcpEmu"},o.prototype=new r;var a=function(){!function(t){var e,n,i,r,o;t.add=function(t,e,i){if("undefined"!=typeof callCord&&callCord("main").record({fn:"add",className:"later"}),e||i){var r;"[object Array]"===Object.prototype.toString.call(i)?r=i:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),n.push([e,t,r])}else n.push(t)},t.asap=function(t){"undefined"!=typeof callCord&&callCord("main").record({fn:"asap",className:"later"}),this.add(t)},t.every=function(t,e,n){"undefined"!=typeof callCord&&callCord("main").record({fn:"every",className:"later"}),n||(n="time"+(new Date).getTime()+Math.random(1e7)),r[n]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){var t,a;if(this.polyfill(),"undefined"!=typeof window){var t=window.requestAnimationFrame,a=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],a=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),a||(a=function(t){clearTimeout(t)}),n=[],i={},r={},o=[];var c=0,s=function(){for(var e,a=(new Date).getTime();e=n.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<o.length;f++){var l=o[f];l()}for(var d in i)if(i.hasOwnProperty(d)){var u=i[d];u[0](u[1]),delete i[d]}for(var d in r)if(r.hasOwnProperty(d)){var u=r[d];u.nextTime<a&&(u.fn(),u.nextTime=a+u.step),u.until&&u.until<a&&delete r[d]}t(s),c=a};s(),e=!0}}),t.once=function(t,e,n){"undefined"!=typeof callCord&&callCord("main").record({fn:"once",className:"later"}),i[t]=[e,n]},t.onFrame=function(t){"undefined"!=typeof callCord&&callCord("main").record({fn:"onFrame",className:"later"}),o.push(t)},t.polyfill=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"polyfill",className:"later"})},t.removeFrameFn=function(t){"undefined"!=typeof callCord&&callCord("main").record({fn:"removeFrameFn",className:"later"});var e=o.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),o.splice(e,1),!0):!1}}(this)},c=function(t,e,n,i,r,o,a,s){var f,l=this;if(!(l instanceof c))return new c(t,e,n,i,r,o,a,s);var d=[t,e,n,i,r,o,a,s];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){f=t.apply(l,d)}),"function"==typeof f){if(f._classInfo.name!=c._classInfo.name)return new f(t,e,n,i,r,o,a,s)}else if(f)return f;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,d)}):"function"==typeof l.init&&l.init.apply(l,d)};c._classInfo={name:"later"},c.prototype=new a;var s=function(){!function(t){t.on=function(t,e){return"undefined"!=typeof callCord&&callCord("main").record({fn:"on",className:""}),this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.trigger=function(t,e,n){if("undefined"!=typeof callCord&&callCord("main").record({fn:"trigger",className:""}),this._ev&&this._ev[t]){return this._ev[t].forEach(function(t){t(e,n)}),this}}}(this),function(t){var e,n;t.delegateToRoom=function(t,n,i){"undefined"!=typeof callCord&&callCord("main").record({fn:"delegateToRoom",className:"_serverSocketWrap"});var r=this._roomPrefix+":"+t;if(e&&e[r]){var o=this;e[r].forEach(function(t){t!=o&&t.emit(n,i)})}},t.disconnect=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"disconnect",className:"_serverSocketWrap"});var t=this;t._disconnected=!0,t.leaveFromRooms(),t.trigger("disconnect",t),t._disconnected=!0;var e=this._tcp._dbName;_localDB().clearDatabases(function(t){return t.name==e?!0:void 0})},t.emit=function(t,e){"undefined"!=typeof callCord&&callCord("main").record({fn:"emit",className:"_serverSocketWrap"}),this._tcp.messageFrom({name:t,data:e})},t.getId=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"getId",className:"_serverSocketWrap"}),this._tcp._socketId},t.getUserId=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"getUserId",className:"_serverSocketWrap"}),this._userId},t.getUserRoles=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"getUserRoles",className:"_serverSocketWrap"}),this._roles},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){var n=this;this._roomPrefix=e.getPrefix(),this._tcp=t,this._server=e;t.on("serverMessage",function(t,e){return n._disconnected?void 0:e.disconnect?void n.disconnect():void(e._callBackId?n.trigger(e.name,e.data,function(t){n.emit(e._callBackId,t)}):n.trigger(e.name,e.data))}),this.broadcast={to:function(t){return{emit:function(e,i){n.delegateToRoom(t,e,i)}}}}}),t.isConnected=function(){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isConnected",className:"_serverSocketWrap"}),this._disconnected?!1:!0},t.isInRoom=function(t){return"undefined"!=typeof callCord&&callCord("main").record({fn:"isInRoom",className:"_serverSocketWrap"}),n?n[this.getId()].indexOf(t)>=0:!1},t.join=function(t){"undefined"!=typeof callCord&&callCord("main").record({fn:"join",className:"_serverSocketWrap"});var i=this._roomPrefix+":"+t;e||(e={}),e[i]||(e[i]=[]),e[i].indexOf(this)<0&&(e[i].push(this),n||(n={}),n[this.getId()]||(n[this.getId()]=[]),n[this.getId()].push(t))},t.leave=function(t){"undefined"!=typeof callCord&&callCord("main").record({fn:"leave",className:"_serverSocketWrap"});var i=this._roomPrefix+":"+t;e||(e={}),e[i]||(e[i]=[]);var r;if((r=e[i].indexOf(this))>=0){e[i].splice(r,1);var o=this.getId(),a=n[o].indexOf(t);a>=0&&n[o].splice(a,1)}},t.leaveFromRooms=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"leaveFromRooms",className:"_serverSocketWrap"});var t=this.getId(),e=this;n&&n[t]&&n[t].forEach(function(t){e.leave(t)})},t.removeListener=function(){"undefined"!=typeof callCord&&callCord("main").record({fn:"removeListener",className:"_serverSocketWrap"})},t.setAuthInfo=function(t,e){"undefined"!=typeof callCord&&callCord("main").record({fn:"setAuthInfo",className:"_serverSocketWrap"}),this._userId=t,this._roles=e}}(this)},f=function(t,e,n,i,r,o,a,c){var s,l=this;if(!(l instanceof f))return new f(t,e,n,i,r,o,a,c);var d=[t,e,n,i,r,o,a,c];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){s=t.apply(l,d)}),"function"==typeof s){if(s._classInfo.name!=f._classInfo.name)return new s(t,e,n,i,r,o,a,c)}else if(s)return s;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,d)}):"function"==typeof l.init&&l.init.apply(l,d)};f._classInfo={name:"_serverSocketWrap"},f.prototype=new s,function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},e=function(t,n,i,r,o,a,c,s){var f,l=this;if(!(l instanceof e))return new e(t,n,i,r,o,a,c,s);var d=[t,n,i,r,o,a,c,s];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){f=t.apply(l,d)}),"function"==typeof f){if(f._classInfo.name!=e._classInfo.name)return new f(t,n,i,r,o,a,c,s)}else if(f)return f;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,d)}):"function"==typeof l.init&&l.init.apply(l,d)};e._classInfo={name:"socketEmulator"},e.prototype=new t}).call(new Function("return this")());