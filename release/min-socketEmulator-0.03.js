var _socketEmu_prototype=function(){"use strict";var t=function(){!function(t){t.on=function(t,i){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(i),this},t.removeListener=function(t,i){if(this._ev&&this._ev[t])for(var n=this._ev[t],e=0;e<n.length;e++)if(n[e]==i)return void n.splice(e,1)},t.trigger=function(t,i,n){if(this._ev&&this._ev[t]){return this._ev[t].forEach(function(t){t(i,n)}),this}}}(this),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.disconnect=function(){this._socket.messageTo({disconnect:!0})},t.emit=function(t,i,n){var e={name:t,data:i};if(n){e._callBackId=this.guid();var o=this,r=function(t){n(t),o.removeListener(e._callBackId,r)};this.on(e._callBackId,r)}this._socket.messageTo(e)},t.getId=function(){return this.socketId},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,n){var e=n||this.guid(),o=this,s=r(t,i,"openConnection","client"),a=r(t,i,e,"client");this.socketId=e,a.on("clientMessage",function(t,i){i.connected?(o._socket=a,o.trigger("connect",a)):o.trigger(i.name,i.data)}),s.messageTo({socketId:e})})}(this)},i=function(t,n,e,o,r,s,a,c){if(!(this instanceof i))return new i(t,n,e,o,r,s,a,c);var f=[t,n,e,o,r,s,a,c];if(this.__factoryClass){var _,u=this;if(this.__factoryClass.forEach(function(t){_=t.apply(u,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=i._classInfo.name)return new _(t,n,e,o,r,s,a,c)}else if(_)return _}if(this.__traitInit){var u=this;this.__traitInit.forEach(function(t){t.apply(u,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"_clientSocket"},i.prototype=new t,"undefined"!=typeof window&&(window._clientSocket=i),"undefined"!=typeof window&&(window._clientSocket_prototype=t);var n=function(){!function(t){t.on=function(t,i){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(i),this},t.trigger=function(t,i,n){if(this._ev&&this._ev[t]){return this._ev[t].forEach(function(t){t(i,n)}),this}}}(this),function(t){var i,n;t.emit=function(){},t.getPrefix=function(){return this._ip+":"+this._port},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){n||(n={},i={});var o=this;this._ip=t,this._port=e;var s=r(t,e,"openConnection","server");s.on("serverMessage",function(n,s){if(s.socketId){var a=r(t,e,s.socketId,"server"),c=f(a,o);i[s.socketId]=c,o.trigger("connect",c),c.isConnected()&&a.messageFrom({connected:!0,socketId:s.socketId})}})}),t.join=function(){},t.removeListener=function(){}}(this)},e=function(t,i,n,o,r,s,a,c){if(!(this instanceof e))return new e(t,i,n,o,r,s,a,c);var f=[t,i,n,o,r,s,a,c];if(this.__factoryClass){var _,u=this;if(this.__factoryClass.forEach(function(t){_=t.apply(u,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=e._classInfo.name)return new _(t,i,n,o,r,s,a,c)}else if(_)return _}if(this.__traitInit){var u=this;this.__traitInit.forEach(function(t){t.apply(u,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"_serverSocket"},e.prototype=new n,"undefined"!=typeof window&&(window._serverSocket=e),"undefined"!=typeof window&&(window._serverSocket_prototype=n);var o=function(){!function(t){t.on=function(t,i){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(i),this},t.trigger=function(t,i,n){if(this._ev&&this._ev[t]){var e=this;return this._ev[t].forEach(function(t){t(e,i,n)}),this}}}(this),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i;t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n,e,o){var r=this;this._server=t,this._port=n,this._socketId=e,this._dbName="tcp://"+this._server+":"+this._port+":"+this._socketId;var s=this._dbName+":to",c=this._dbName+":from";i||(i={}),i[s]||(i[s]=[]),i[c]||(i[c]=[]),a().every(.1,function(){if("server"==o){var t=i[s].slice();t.forEach(function(t){r.trigger("serverMessage",t),i[s].shift()})}if("client"==o){var t=i[c].slice();t.forEach(function(t){r.trigger("clientMessage",t),i[c].shift()})}})}),t.messageFrom=function(t){var n=this._dbName+":from";i[n].push(t)},t.messageTo=function(t){var n=this._dbName+":to";i[n].push(t)}}(this)},r=function(t,i,n,e,o,s,a,c){if(!(this instanceof r))return new r(t,i,n,e,o,s,a,c);var f=[t,i,n,e,o,s,a,c];if(this.__factoryClass){var _,u=this;if(this.__factoryClass.forEach(function(t){_=t.apply(u,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=r._classInfo.name)return new _(t,i,n,e,o,s,a,c)}else if(_)return _}if(this.__traitInit){var u=this;this.__traitInit.forEach(function(t){t.apply(u,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"_tcpEmu"},r.prototype=new o,"undefined"!=typeof window&&(window._tcpEmu=r),"undefined"!=typeof window&&(window._tcpEmu_prototype=o);var s=function(){!function(t){var i,n,e,o,r;t.add=function(t,i,e){if(i||e){var o;"[object Array]"===Object.prototype.toString.call(e)?o=e:(o=Array.prototype.slice.call(arguments,2),o||(o=[])),n.push([i,t,o])}else n.push(t)},t.asap=function(t){this.add(t)},t.every=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),o[n]={step:Math.floor(1e3*t),fn:i,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!i){var t,s;if(this.polyfill(),"undefined"!=typeof window){var t=window.requestAnimationFrame,s=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(i){t||(t=window[i+"RequestAnimationFrame"],s=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),s||(s=function(t){clearTimeout(t)}),n=[],e={},o={},r=[];var a=0,c=function(){for(var i,s=(new Date).getTime();i=n.shift();)"[object Array]"===Object.prototype.toString.call(i)?i[1].apply(i[0],i[2]):i();for(var f=0;f<r.length;f++){var _=r[f];_()}for(var u in e)if(e.hasOwnProperty(u)){var h=e[u];h[0](h[1]),delete e[u]}for(var u in o)if(o.hasOwnProperty(u)){var h=o[u];h.nextTime<s&&(h.fn(),h.nextTime=s+h.step),h.until&&h.until<s&&delete o[u]}t(c),a=s};c(),i=!0}}),t.once=function(t,i,n){e[t]=[i,n]},t.onFrame=function(t){r.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var i=r.indexOf(t);return i>=0?(t._onRemove&&t._onRemove(),r.splice(i,1),!0):!1}}(this)},a=function(t,i,n,e,o,r,s,c){if(!(this instanceof a))return new a(t,i,n,e,o,r,s,c);var f=[t,i,n,e,o,r,s,c];if(this.__factoryClass){var _,u=this;if(this.__factoryClass.forEach(function(t){_=t.apply(u,f)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=a._classInfo.name)return new _(t,i,n,e,o,r,s,c)}else if(_)return _}if(this.__traitInit){var u=this;this.__traitInit.forEach(function(t){t.apply(u,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};a._classInfo={name:"later"},a.prototype=new s;var c=function(){!function(t){t.on=function(t,i){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(i),this},t.trigger=function(t,i,n){if(this._ev&&this._ev[t]){return this._ev[t].forEach(function(t){t(i,n)}),this}}}(this),function(t){var i,n;t.delegateToRoom=function(t,n,e){var o=this._roomPrefix+":"+t;if(i&&i[o]){var r=this;i[o].forEach(function(t){t!=r&&t.emit(n,e)})}},t.disconnect=function(){var t=this;t._disconnected=!0,t.leaveFromRooms(),t.trigger("disconnect",t),t._disconnected=!0;var i=this._tcp._dbName;_localDB().clearDatabases(function(t){return t.name==i?!0:void 0})},t.emit=function(t,i){this._tcp.messageFrom({name:t,data:i})},t.getId=function(){return this._tcp._socketId},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i){var n=this;this._roomPrefix=i.getPrefix(),this._tcp=t,this._server=i;t.on("serverMessage",function(t,i){return n._disconnected?void 0:i.disconnect?void n.disconnect():void(i._callBackId?n.trigger(i.name,i.data,function(t){n.emit(i._callBackId,t)}):n.trigger(i.name,i.data))}),this.broadcast={to:function(t){return{emit:function(i,e){n.delegateToRoom(t,i,e)}}}}}),t.isConnected=function(){return this._disconnected?!1:!0},t.isInRoom=function(t){return n?n[this.getId()].indexOf(t)>=0:!1},t.join=function(t){var e=this._roomPrefix+":"+t;i||(i={}),i[e]||(i[e]=[]),i[e].indexOf(this)<0&&(i[e].push(this),n||(n={}),n[this.getId()]||(n[this.getId()]=[]),n[this.getId()].push(t))},t.leave=function(t){var e=this._roomPrefix+":"+t;i||(i={}),i[e]||(i[e]=[]);var o;if((o=i[e].indexOf(this))>=0){i[e].splice(o,1);var r=this.getId(),s=n[r].indexOf(t);s>=0&&n[r].splice(s,1)}},t.leaveFromRooms=function(){var t=this.getId(),i=this;n&&n[t]&&n[t].forEach(function(t){i.leave(t)})},t.removeListener=function(){}}(this)},f=function(t,i,n,e,o,r,s,a){if(!(this instanceof f))return new f(t,i,n,e,o,r,s,a);var c=[t,i,n,e,o,r,s,a];if(this.__factoryClass){var _,u=this;if(this.__factoryClass.forEach(function(t){_=t.apply(u,c)}),"[object Function]"==Object.prototype.toString.call(_)){if(_._classInfo.name!=f._classInfo.name)return new _(t,i,n,e,o,r,s,a)}else if(_)return _}if(this.__traitInit){var u=this;this.__traitInit.forEach(function(t){t.apply(u,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};f._classInfo={name:"_serverSocketWrap"},f.prototype=new c,"undefined"!=typeof window&&(window._serverSocketWrap=f),"undefined"!=typeof window&&(window._serverSocketWrap_prototype=c),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},_socketEmu=function(t,i,n,e,o,r,s,a){if(!(this instanceof _socketEmu))return new _socketEmu(t,i,n,e,o,r,s,a);var c=[t,i,n,e,o,r,s,a];if(this.__factoryClass){var f,_=this;if(this.__factoryClass.forEach(function(t){f=t.apply(_,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=_socketEmu._classInfo.name)return new f(t,i,n,e,o,r,s,a)}else if(f)return f}if(this.__traitInit){var _=this;this.__traitInit.forEach(function(t){t.apply(_,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};_socketEmu._classInfo={name:"_socketEmu"},_socketEmu.prototype=new _socketEmu_prototype,"undefined"!=typeof window&&(window._socketEmu=_socketEmu),"undefined"!=typeof window&&(window._socketEmu_prototype=_socketEmu_prototype);